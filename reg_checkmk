- name: Install + register Checkmk agent
  hosts: all
  become: true

  roles:
    - role: checkmk.general.agent
      vars:
        # Where your Checkmk site lives
        checkmk_agent_server: "10.64.0.156"
        checkmk_agent_site: "monitoring"

        # User used for registration (must have automation secret set)
        checkmk_agent_user: "agent_registration"
        checkmk_agent_secret: "pMZHlaWWb&LE3H3O"

        # Hostname is REQUIRED (this is the same flag your manual command complained about)
        checkmk_agent_hostname: "{{ inventory_hostname }}"

        # Optional: if you use folders / autoregistration rules, include folder/path variables if your setup expects them
        # checkmk_agent_folder: "/Linux"

